<div class="max-w-4xl mx-auto">
  <div class="page-header">
    <div class="flex items-center space-x-2 mb-2">
      <a routerLink="/" class="text-secondary-500 hover:text-secondary-700 text-sm">Home</a>
      <span class="text-secondary-400">/</span>
      <a routerLink="/tools" class="text-secondary-500 hover:text-secondary-700 text-sm">Tools</a>
      <span class="text-secondary-400">/</span>
      <span class="text-secondary-900 font-medium text-sm">Protect PDF</span>
    </div>
    <h1 class="page-title">Protect PDF</h1>
    <p class="page-subtitle">Add password protection and permissions</p>
  </div>

  <div class="space-y-6">
    <!-- Upload -->
    <div class="card" *ngIf="!protected">
      <div class="card-header">
        <h3 class="font-semibold text-secondary-900">Upload PDF</h3>
      </div>
      <div class="card-body">
        <nz-upload nzType="drag" [nzBeforeUpload]="beforeUpload" [(nzFileList)]="fileList" class="upload-zone">
          <p class="ant-upload-drag-icon">
            <i nz-icon nzType="file-pdf" nzTheme="outline" class="text-5xl text-red-500"></i>
          </p>
          <p class="ant-upload-text">Drop PDF here to protect</p>
        </nz-upload>
      </div>
    </div>

    <!-- Password Settings -->
    <div class="card" *ngIf="fileList.length > 0 && !protected">
      <div class="card-header">
        <h3 class="font-semibold text-secondary-900">Password Settings</h3>
      </div>
      <div class="card-body space-y-4">
        <div>
          <label class="form-label">User Password <span class="text-danger-500">*</span></label>
          <div class="relative">
            <input 
              [type]="showPassword ? 'text' : 'password'" 
              [(ngModel)]="options.userPassword"
              (input)="checkPasswordStrength()"
              placeholder="Enter password to open PDF"
              class="form-input pr-10">
            <button (click)="showPassword = !showPassword" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-secondary-400 hover:text-secondary-600">
              <i nz-icon [nzType]="showPassword ? 'eye-invisible' : 'eye'"></i>
            </button>
          </div>
          <div class="mt-2" *ngIf="options.userPassword">
            <div class="flex items-center space-x-2">
              <div class="flex-1 h-2 bg-secondary-200 rounded-full overflow-hidden">
                <div class="h-full transition-all duration-300" 
                     [style.width.%]="passwordStrength"
                     [class.bg-red-500]="passwordStrength <= 25"
                     [class.bg-orange-500]="passwordStrength > 25 && passwordStrength <= 50"
                     [class.bg-yellow-500]="passwordStrength > 50 && passwordStrength <= 75"
                     [class.bg-green-500]="passwordStrength > 75"></div>
              </div>
              <span class="text-sm" [class.text-red-600]="passwordStrength <= 25" [class.text-orange-600]="passwordStrength > 25 && passwordStrength <= 50" [class.text-yellow-600]="passwordStrength > 50 && passwordStrength <= 75" [class.text-green-600]="passwordStrength > 75">{{ passwordStrengthText }}</span>
            </div>
          </div>
        </div>

        <div>
          <label class="form-label">Owner Password (Optional)</label>
          <input type="password" [(ngModel)]="options.ownerPassword" placeholder="For advanced permissions" class="form-input">
          <p class="text-xs text-secondary-500 mt-1">Used for managing permissions without opening the document</p>
        </div>

        <div>
          <label class="form-label">Encryption Level</label>
          <nz-select [(ngModel)]="options.encryptionLevel" class="w-full">
            <nz-option nzValue="256" nzLabel="256-bit AES (Recommended)"></nz-option>
            <nz-option nzValue="128" nzLabel="128-bit AES"></nz-option>
          </nz-select>
        </div>
      </div>
    </div>

    <!-- Permissions -->
    <div class="card" *ngIf="fileList.length > 0 && !protected">
      <div class="card-header">
        <h3 class="font-semibold text-secondary-900">Permissions</h3>
      </div>
      <div class="card-body space-y-3">
        <label nz-checkbox [(ngModel)]="options.allowPrinting">
          <span class="text-secondary-700">Allow printing</span>
        </label>
        <label nz-checkbox [(ngModel)]="options.allowCopying">
          <span class="text-secondary-700">Allow copying text & images</span>
        </label>
        <label nz-checkbox [(ngModel)]="options.allowEditing">
          <span class="text-secondary-700">Allow editing</span>
        </label>
        <label nz-checkbox [(ngModel)]="options.allowAnnotating">
          <span class="text-secondary-700">Allow commenting & annotating</span>
        </label>
      </div>
    </div>

    <!-- Protect Button -->
    <div class="card" *ngIf="fileList.length > 0 && !protected">
      <div class="card-body">
        <button (click)="onProtect()" [disabled]="protecting || !options.userPassword" class="btn-primary w-full py-3">
          <i nz-icon nzType="lock" nzTheme="outline" class="mr-2"></i>
          {{ protecting ? 'Protecting...' : 'Protect PDF' }}
        </button>
      </div>
    </div>

    <!-- Success -->
    <div class="card" *ngIf="protected">
      <div class="card-body text-center py-8">
        <div class="w-16 h-16 bg-success-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <i nz-icon nzType="lock" nzTheme="outline" class="text-3xl text-success-600"></i>
        </div>
        <h3 class="text-xl font-bold text-secondary-900 mb-2">PDF Protected Successfully</h3>
        <p class="text-secondary-500 mb-6">Your PDF is now password-protected with {{ options.encryptionLevel }}-bit encryption</p>
        
        <div class="flex flex-col sm:flex-row gap-3 justify-center">
          <button (click)="onDownload()" class="btn-primary">
            <i nz-icon nzType="download" nzTheme="outline" class="mr-2"></i>
            Download Protected PDF
          </button>
          <button (click)="onReset()" class="btn-secondary">
            <i nz-icon nzType="reload" nzTheme="outline" class="mr-2"></i>
            Protect Another
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
